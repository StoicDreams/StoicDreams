"use strict";{let contentSignin=`\n<form id="signinform">\n<webui-tabs theme="secondary" index="1" transition-timing="200" data-subscribe="session-signin-tab-index:setTab">\n    <webui-button align="left" slot="tabs">Sign-In</webui-button>\n    <webui-content slot="content" src="/d/forms/signin.md" theme="default"></webui-content>\n    <webui-button align="left" slot="tabs">Create Account</webui-button>\n    <webui-content slot="content" src="/d/forms/create-account.md" theme="default"></webui-content>\n</webui-tabs>\n<webui-alert severity="danger"></webui-alert>\n<webui-quote theme="info">\n${webui.parseWebuiMarkdown("Not using a password manager? We recommend using [bitWarden](https://bitwarden.com/) for securely storing, managing, and sharing sensitive information such as passwords, passkeys, and credit cards.")}\n</webui-quote>\n<webui-myfi-storage-consent></webui-myfi-storage-consent>\n</form>\n`,contentSignedIn='\n<webui-alert show severity="info">You are already signed in</webui-alert>\n<webui-input-range name="autosignout" data-subscribe="session-autosignout:setValue" data-trigger="session-autosignout" label="Inactivity Signout" title="Minutes of inactivity to auto-sign-out" min="5" step="5" max="2880"></webui-input-range>\n',contentSignInDomain='\n<form id="signindomain">\n<webui-content slot="content" src="/d/forms/signin-domain.md" theme="default"></webui-content>\n<webui-alert severity="danger"></webui-alert>\n</form>\n',contentForgotPassword='\n<p>Confirm your email for your account. If your email matches an active account sign-in email we will send you an email with a link to reset your password.</p>\n<webui-input-text theme="primary" name="email" label="Email" autofocus></webui-input-text>\n<webui-alert severity="danger"></webui-alert>\n';webui.define("app-signin",{watchVisibility:!1,isInput:!1,preload:"",constructor(){this.addEventListener("click",(ev=>{webui.closest(ev.target,'[name="forgotpassword"]')&&webui.dialog({title:"Reset Password",minWidth:"80%",content:contentForgotPassword,confirm:"Request Password Reset Email",cancel:"Cancel",onconfirm:async(data,content)=>{const jsonData=Object.fromEntries(data);let alert=content.querySelector("webui-alert");if(!jsonData.email)return alert.setValue("Please enter your email used for your account login"),!1;let result=await webui.fetchApi("user/forgotpassword",jsonData);if(200===result.status)return!0;let message=await result.text();return alert.setValue(message||"An unexpected error happened. Please wait a moment and try again."),!1}})}))},flags:[],attr:["height","max-height"],attrChanged(property,value){const t=this;switch(property){case"height":t.style.height=webui.pxIfNumber(value);break;case"maxHeight":t.style.maxHeight=webui.pxIfNumber(value)}},connected(){this.setupComponent(),this.addDataset("subscribe","session-user-role:render")},setupComponent(){this.render(),void 0===webui.getData("session-autosignout")&&webui.setData("session-autosignout",30)},render(){const t=this;let domain=webui.getQueryData("domain");if(webui.isSignedIn)if(domain&&domain.length>4&&-1!==domain.indexOf(".")){webui.setData("page-domain",domain.replace(".","&#8203;.")),t.innerHTML=contentSignInDomain;let form=t.querySelector("#signindomain"),alert=t.querySelector("webui-alert");form.addEventListener("submit",(ev=>{ev.stopPropagation(),ev.preventDefault();const data={signin_domain:domain};let resp;webui.fetchApi("user/signin/domain",data).then((r=>(resp=r,resp.text()))).then((async text=>{200===resp.status?window.self===window.top&&document.referrer?location.href=`https://${domain}`:webui.alert(text||"Success","success"):alert.setValue(text||`An unknown error occurred signing you in to ${domain}`)})).catch((ex=>{alert.setValue(`Error: ${ex}`)}))}))}else t.innerHTML=contentSignedIn;else{t.innerHTML=contentSignin;let form=t.querySelector("#signinform"),alert=t.querySelector("webui-alert");form.addEventListener("submit",(ev=>{const isSignin=0===webui.getData("session-signin-tab-index");ev.stopPropagation(),ev.preventDefault();const formData=new FormData(form),jsonData=Object.fromEntries(formData);if(jsonData.email){if(isSignin){if(!jsonData.password)return void alert.setValue("Password is required");let resp;delete jsonData["x-cookie-age"],webui.fetchApi("user/signin",jsonData).then((r=>(resp=r,resp.text()))).then((async text=>{200===resp.status?(await webui.fetchApi("cookie/age"),await webui.loadRoles(),webui.hasRole(1)?(text&&webui.alert(text,"success"),(!domain||domain.length<4)&&webui.navigateTo("/")):alert.setValue("An issue occurred signing you in. Please wait a moment and try again.")):alert.setValue(text||"Invalid credentials")})).catch((ex=>{alert.setValue(`Error: ${ex}`)}))}else{let resp;webui.fetchApi("user/create",jsonData).then((r=>(resp=r,resp.text()))).then((text=>{webui.alert(text||"Account successfully created",409===resp.status?"warning":resp.status>400?"danger":"success")})).catch((ex=>{alert.setValue(`Error: ${ex}`)}))}return!1}alert.setValue("Email is required")}))}}})}